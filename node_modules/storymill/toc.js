var fs = require('fs');
var storymill = require("storymill/storymill");

/**
 * Получить список текстов
 *
 * @param {Object} params
 * returns json
 */
exports.getTocList = function(params) {
    var dirs = fs.readdirSync(params.textsFolder);

    if (dirs.length === 0) {
        console.log('Опасность! Каталог с текстами пуст');
        return [];
    }

    var tocList = dirs.map(function(dirName){
        var dirPath = params.textsFolder + '/' + dirName;
        var filePath = dirPath +'/' + dirName + '.sm.html';

        if (fs.existsSync(filePath)) {
            var storyJson = storymill.getStoryJson(filePath);

            return {
                name: dirName,
                json: storyJson,
                title: storyJson[0].text
            }
        }

        console.log('Ошибка: нет HTML-файла-сырца в директории' + dirPath);
        return false;
    });

    return tocList;
};
