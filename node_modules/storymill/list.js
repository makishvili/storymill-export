var fs = require('fs');
var jspath = require("jspath");
var smCfg = require("./config").get('storymill');

/**
 * Получить список книг
 *
 * @param {Object} params
 * returns json
 */
exports.getBookList = function(params) {
    var dirs = fs.readdirSync(params.folderImport);

    if (dirs.length === 0) {
        console.log('Опасность! Каталог с книгами пуст!');
        return [];
    }

    // Получаю массив книг
    return dirs.filter(function (bookId) {
        // Игнорирую служеные файлы на fs
        return bookId.indexOf('.') === -1
    })
    .map(function (bookId) {
        // Отбрасываю те, которых нет в /configs/storymill
        // Возвращаю конфиговый объект для каждой книги
        return jspath('.{.id === $bookId}[0]', smCfg.bookList, { bookId: bookId });
    });
};
